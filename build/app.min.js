/*! slots 2014-04-11 */
$(function(){var a=["a","k","q","j","10","bad","borlotta","jackpot","mayor","owl","priscilla","rango1","rango2","rango3","snake"],b={container:$("#container"),showJackpot:!1,images:a,minorWinOn:"rango1",majorWinOn:"jackpot"};$("#win-minor").css("background",'url("assets/images/rango-win.gif?'+_.now()+'") no-repeat'),$("#win-major").css("background",'url("assets/images/rango-win.gif?'+_.now()+'") no-repeat'),slots.init(b),$(document).on("slots-show-win",function(a){a.$spinBtn.prop("disabled",!0),$("#win-"+a.prize).animate({top:0,opacity:1},250,"easeOutQuad",function(){var b=$(this);setTimeout(function(){b.find("div").fadeIn("fast",function(){a.$spinBtn.prop("disabled",!1)})},2500)}),"major"==a.prize&&setInterval(function(){$("#jackpot").text(a.$jackpot.text())},150)}).on("slots-hide-win",function(){$(".win").animate({top:"-458px",opacity:0},250,"easeOutQuad",function(){$(this).find("div").hide()})})}),window.slots=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u={container:null,jackpot:2467589.32,spinBtnText:"",images:[],imagesDir:"build/images/slot_elements/",imageExt:".png",imageWidth:100,imageHeight:103,cols:5,rows:3,majorWinOnly:!1,minorWinRate:2,majorWinRate:5,minorWinOn:"",majorWinOn:"",noWinOn:1,duration:600,delayed:200,easing:"easeOutBounce",startMsg:"",tryAgainMsg:""},v={$container:null,$slotsWrapper:null,$slots:null,$winningLine:null,$jackpot:null,$statusDisplay:null,$spinBtn:null},w={slots:[],spins:0,isSpinning:!1,colLoadedCounter:0,minorWinAt:0,majorWinAt:0,width:"",height:"",offsetPixel:0,topPixel:"",minorWin:!1,majorWin:!1,jackpot:"",prize:null};return a=function(a){$.extend(v,a)},b=function(){w.minorWinAt=_.random(u.noWinOn+1,u.minorWinRate),w.majorWinAt=_.random(u.minorWinRate+1,u.majorWinRate),console.log("minor win on: "+w.minorWinAt),console.log("major win on: "+w.majorWinAt)},c=function(){a({$container:u.container}),b(),w.width=parseInt(u.imageWidth*u.cols)+"px",w.height=parseInt(u.imageHeight*u.rows)+"px",w.offsetPixel=parseInt(u.imageHeight*(_.size(u.images)-u.rows)),w.topPixel="-"+parseInt(u.imageHeight*u.rows)+"px"},d=function(){var b=document.createElement("div"),c=document.createElement("div");b.className="slots-wrapper",c.className="slots",b.appendChild(c),v.$container.addClass("slots-loading").append(b),a({$slotsWrapper:v.$container.find(".slots-wrapper"),$slots:v.$container.find(".slots")}),c.style.width=w.width,c.style.height=w.height,_.each(e(),function(a){c.appendChild(a)}),i(),k(),l(),m()},e=function(){var a=0,b=[];for(w.slots=[];a<u.cols;a++)b.push(f());return h()?b:void e()},f=function(){var a=document.createElement("ul");return a.style.marginTop="-"+w.offsetPixel+"px",_.each(g(),function(b){a.appendChild(b)}),a},g=function(){var a=[],b=[],c=[],d=0,e=0;return $.extend(a,_.shuffle(u.images)),w.minorWin=!1,w.majorWin=!1,w.spins!=w.minorWinAt-1||u.majorWinOnly?w.spins==w.majorWinAt-1&&(w.majorWin=!0,d=a.indexOf(u.majorWinOn),a.splice(d,1),a.splice(2,0,u.majorWinOn)):(w.minorWin=!0,d=a.indexOf(u.minorWinOn),a.splice(d,1),a.splice(1,0,u.minorWinOn)),_.each(a,function(a){var d=document.createElement("li"),f=new Image;d.style.width=u.imageWidth+"px",d.style.height=u.imageHeight+"px",f.src=u.imagesDir+a+u.imageExt,f.setAttribute("data-value",a),f.onload=function(){e++,e==u.images.length&&$(document).trigger("load-complete")},d.appendChild(f),b.push(d),c.push(a)}),w.slots.push(c),b},h=function(){for(var a=0,b=[],c=[],d=[],e=[],f=[],g=[];a<w.slots.length;a++)if(d=w.slots[a].slice(0,u.rows),e=w.slots[a].slice(-u.rows),a>0){if(f=_.intersection(d,b),g=_.intersection(e,c),!f.length||!g.length)return!0;b=f,c=g}else b=d,c=e;return!1},i=function(){var b=document.createElement("div");b.className="slots-jackpot",v.$slotsWrapper.prepend(b),a({$jackpot:v.$slotsWrapper.find(".slots-jackpot")}),j=setInterval(function(){var a=_.random(0,50);u.jackpot+=a/100,w.jackpot="$"+u.jackpot.toLocaleString("en-US",{minimumFractionDigits:2}),b.innerHTML=w.jackpot},150)},k=function(){var b=document.createElement("div"),c=document.createElement("span"),d=document.createElement("span");b.className="slots-status-display show-start",c.className="slots-status-start",c.innerHTML=u.startMsg,d.className="slots-status-try-again",d.innerHTML=u.tryAgainMsg,b.appendChild(c),b.appendChild(d),v.$slotsWrapper.append(b),a({$statusDisplay:v.$slotsWrapper.find(".slots-status-display")}),$(document).on("slots-spinning",function(){b.className="slots-status-display"}).on("slots-stopped",function(){w.minorWin||w.majorWin||(b.className="slots-status-display show-try-again")})},l=function(){var b=document.createElement("button");b.className="slots-btn",b.innerHTML=u.spinBtnText,v.$slotsWrapper.append(b),a({$spinBtn:v.$slotsWrapper.find(".slots-btn")}),$(document).on("slots-spinning",function(){b.disabled=!0}).on("slots-stopped",function(){b.disabled=!1})},m=function(){var b=document.createElement("div");b.className="slots-winning-line",v.$slots.append(b),a({$winningLine:v.$slots.find(".slots-winning-line")})},n=function(a){if(a.preventDefault(),"minor"==w.prize&&($(document).trigger("slots-hide-win"),w.prize=null),!w.isSpinning){var b=0,c=0,d=w.minorWin||w.majorWin?2*u.duration:u.duration;for($(document).trigger("slots-spinning");b<u.cols;b++)c=u.duration,(w.minorWin||w.majorWin)&&b==u.cols-1&&(c=2*c),v.$slots.find("ul:eq("+b+")").delay(u.delayed*b).animate({top:w.offsetPixel},c,u.easing),d+=u.delayed;setTimeout(function(){$(document).trigger("slots-stopped"),console.log("spins: "+w.spins),console.log("minorWin: "+w.minorWin),console.log("majorWin: "+w.majorWin),_.each(e(),function(a,b){v.$slots.find("ul:eq("+b+")").prepend(a.innerHTML).css("top",w.topPixel)})},d),w.spins++}},o=function(){console.log("slotsSpinning"),w.isSpinning=!0},p=function(){console.log("slotsStopped"),w.isSpinning=!1,(w.minorWin||w.majorWin)&&s(),w.majorWin&&v.$spinBtn.off("click").on("click",r)},q=function(){w.colLoadedCounter++,w.colLoadedCounter==u.cols&&v.$container.removeClass("slots-loading")},r=function(){window.location="register"},s=function(){var a="";w.prize=w.minorWin?"minor":"major",a="minor"==w.prize?"50%":"257px",v.$winningLine.css({top:a}).addClass("flashing"),v.$spinBtn.prop("disabled",!0),setTimeout(function(){v.$winningLine.css({opacity:0}).removeClass("flashing"),v.$spinBtn.prop("disabled",!1),$(document).trigger({type:"slots-show-win",prize:w.prize,$spinBtn:v.$spinBtn,$jackpot:v.$jackpot})},3e3)},t=function(a){$.extend(u,a),c(),d(),v.$spinBtn.on("click",n),$(document).on("load-complete",q).on("slots-spinning",o).on("slots-stopped",p)},{init:t}}();