/*! slots 2014-04-03 */
$(function(){var a=["a","k","q","j","10","bad","borlotta","jackpot","mayor","owl","priscilla","rango1","rango2","rango3","snake"],b={container:$("#container"),images:a,minorWinOn:"rango1",majorWinOn:"jackpot"};slots.init(b)}),window.slots=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p={container:null,jackpot:2467589.32,images:[],imagesDir:"assets/images/",imageExt:".png",imageWidth:87,imageHeight:96,cols:5,rows:3,minorWinRate:2,majorWinRate:5,minorWinOn:"",majorWinOn:"",noWinOn:1,duration:600,delayed:200,easing:"easeOutBounce"},q={$container:null,$slots:null,$jackpot:null,$spinBtn:null},r={slots:[],spins:0,isSpinning:!1,minorWinAt:0,majorWinAt:0,offsetPixel:0,topPixel:"",minorWin:!1,majorWin:!1,jackpot:p.jackpot};return a=function(a){$.extend(q,a)},b=function(){r.minorWinAt=_.random(p.noWinOn+1,p.minorWinRate),r.majorWinAt=_.random(p.minorWinRate+1,p.majorWinRate),console.log("minor win on: "+r.minorWinAt),console.log("major win on: "+r.majorWinAt)},c=function(){a({$container:p.container}),console.log(q),b(),r.offsetPixel=parseInt(p.imageHeight*(_.size(p.images)-p.rows)),r.topPixel="-"+parseInt(p.imageHeight*p.rows)+"px"},d=function(){var b=document.createElement("div");b.className="slots",q.$container.append(b),a({$slots:q.$container.find(".slots")}),q.$slots.css("height",p.imageHeight*p.rows),_.each(e(),function(a){q.$slots.append(a)}),i(),k()},e=function(){var a=0,b=[];for(r.slots=[];a<p.cols;a++)b.push(f());return h()?b:void e()},f=function(){var a=document.createElement("ul");return a.style.marginTop="-"+r.offsetPixel+"px",_.each(g(),function(b){a.appendChild(b)}),a},g=function(){var a=[],b=[],c=[],d=0,e=_.random(1,p.rows-1);return $.extend(a,_.shuffle(p.images)),r.minorWin=!1,r.majorWin=!1,r.spins==r.minorWinAt-1?(r.minorWin=!0,d=a.indexOf(p.minorWinOn),a.splice(d,1),a.splice(e,0,p.minorWinOn)):r.spins==r.majorWinAt-1&&(r.majorWin=!0,d=a.indexOf(p.majorWinOn),a.splice(d,1),a.splice(e,0,p.majorWinOn)),_.each(a,function(a){var d=document.createElement("li"),e=document.createElement("img");e.src=p.imagesDir+a+p.imageExt,e.setAttribute("data-value",a),d.appendChild(e),b.push(d),c.push(a)}),r.slots.push(c),b},h=function(){for(var a=0,b=[],c=[],d=[],e=[],f=[],g=[];a<r.slots.length;a++)if(d=r.slots[a].slice(0,p.rows),e=r.slots[a].slice(-p.rows),a>0){if(f=_.intersection(d,b),g=_.intersection(e,c),!f.length||!g.length)return!0;b=f,c=g}else b=d,c=e;return!1},i=function(){var b=document.createElement("div");b.className="slots-jackpot",b.innerHTML=p.jackpot,q.$container.prepend(b),a({$jackpot:q.$container.find(".slots-jackpot")}),j=setInterval(function(){},100)},k=function(){var b=document.createElement("button");b.className="slots-btn",b.innerHTML="SPIN",q.$container.append(b),a({$spinBtn:q.$container.find(".slots-btn")})},l=function(a){if(a.preventDefault(),!r.isSpinning){var b=0,c=0,d=r.minorWin||r.majorWin?2*p.duration:p.duration;for(r.isSpinning=!0,r.slots=[];b<p.cols;b++)c=p.duration,(r.minorWin||r.majorWin)&&b==p.cols-1&&(c=2*c),q.$slots.find("ul:eq("+b+")").delay(p.delayed*b).animate({top:r.offsetPixel},c,p.easing),d+=p.delayed;console.log("totalDuration: "+d),setTimeout(function(){r.isSpinning=!1,console.log("spins: "+r.spins),console.log("minorWin: "+r.minorWin),console.log("majorWin: "+r.majorWin),r.minorWin&&m("minor"),r.majorWin&&(console.log("resetting..."),m("major"),n()),_.each(e(),function(a,b){q.$slots.find("ul:eq("+b+")").prepend(a.innerHTML).css("top",r.topPixel)})},d),r.spins++}},m=function(a){alert("show prize: "+a)},n=function(){r.spins=0,b()},o=function(a){$.extend(p,a),c(),d(),q.$spinBtn.on("click",l)},{init:o}}();