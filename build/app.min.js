/*! slots 2014-04-09 */
$(function(){var a=["a","k","q","j","10","bad","borlotta","jackpot","mayor","owl","priscilla","rango1","rango2","rango3","snake"],b={container:$("#container"),showJackpot:!1,images:a,minorWinOn:"rango1",majorWinOn:"jackpot"},c=$("#win");slots.init(b),$(document).on("slots-show-win",function(a){a.$spinBtn.prop("disabled",!0),c.css({background:"url('assets/images/rango-win.gif?"+_.now()+"') no-repeat"}).animate({top:0,opacity:1},250,"easeOutQuad",function(){setTimeout(function(){c.find("#"+a.prize).fadeIn("fast",function(){a.$spinBtn.prop("disabled",!1)})},2500)}),"major"==a.prize&&setInterval(function(){$("#jackpot").text(a.$jackpot.text())},150)}).on("slots-hide-win",function(){c.animate({top:"-458px",opacity:0},250,"easeOutQuad",function(){c.find("div").hide()})})}),window.slots=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t={container:null,jackpot:2467589.32,spinBtnText:"",images:[],imagesDir:"https://raw.githubusercontent.com/jpvuong/slots-app/master/assets/images/",imageExt:".png",imageWidth:100,imageHeight:103,cols:5,rows:3,majorWinOnly:!1,minorWinRate:2,majorWinRate:5,minorWinOn:"",majorWinOn:"",noWinOn:1,duration:600,delayed:200,easing:"easeOutBounce",startMsg:'Click "spin" to spin the reels',tryAgainMsg:"Bad luck. Try another spin to see if you hit a winning line."},u={$container:null,$slotsWrapper:null,$slots:null,$winningLine:null,$jackpot:null,$statusDisplay:null,$spinBtn:null},v={slots:[],spins:0,isSpinning:!1,colLoadedCounter:0,minorWinAt:0,majorWinAt:0,width:"",height:"",offsetPixel:0,topPixel:"",minorWin:!1,majorWin:!1,jackpot:"",prize:null};a=function(a){$.extend(u,a)},b=function(){v.minorWinAt=_.random(t.noWinOn+1,t.minorWinRate),v.majorWinAt=_.random(t.minorWinRate+1,t.majorWinRate),console.log("minor win on: "+v.minorWinAt),console.log("major win on: "+v.majorWinAt)},c=function(){a({$container:t.container}),b(),v.width=parseInt(t.imageWidth*t.cols)+"px",v.height=parseInt(t.imageHeight*t.rows)+"px",v.offsetPixel=parseInt(t.imageHeight*(_.size(t.images)-t.rows)),v.topPixel="-"+parseInt(t.imageHeight*t.rows)+"px"},d=function(){var b=document.createElement("div"),c=document.createElement("div");b.className="slots-wrapper",c.className="slots",b.appendChild(c),u.$container.addClass("slots-loading").append(b),a({$slotsWrapper:u.$container.find(".slots-wrapper"),$slots:u.$container.find(".slots")}),c.style.width=v.width,c.style.height=v.height,_.each(e(),function(a){c.appendChild(a)}),i(),k(),l(),m()},e=function(){var a=0,b=[];for(v.slots=[];a<t.cols;a++)b.push(f());return h()?b:void e()},f=function(){var a=document.createElement("ul");return a.style.marginTop="-"+v.offsetPixel+"px",_.each(g(),function(b){a.appendChild(b)}),a},g=function(){var a=[],b=[],c=[],d=0,e=0;return $.extend(a,_.shuffle(t.images)),v.minorWin=!1,v.majorWin=!1,v.spins!=v.minorWinAt-1||t.majorWinOnly?v.spins==v.majorWinAt-1&&(v.majorWin=!0,d=a.indexOf(t.majorWinOn),a.splice(d,1),a.splice(2,0,t.majorWinOn)):(v.minorWin=!0,d=a.indexOf(t.minorWinOn),a.splice(d,1),a.splice(1,0,t.minorWinOn)),_.each(a,function(a){var d=document.createElement("li"),f=new Image;d.style.width=t.imageWidth+"px",d.style.height=t.imageHeight+"px",f.src=t.imagesDir+a+t.imageExt,f.setAttribute("data-value",a),f.onload=function(){e++,e==t.images.length&&$(document).trigger("load-complete")},d.appendChild(f),b.push(d),c.push(a)}),v.slots.push(c),b},h=function(){for(var a=0,b=[],c=[],d=[],e=[],f=[],g=[];a<v.slots.length;a++)if(d=v.slots[a].slice(0,t.rows),e=v.slots[a].slice(-t.rows),a>0){if(f=_.intersection(d,b),g=_.intersection(e,c),!f.length||!g.length)return!0;b=f,c=g}else b=d,c=e;return!1},i=function(){var b=document.createElement("div");b.className="slots-jackpot",u.$slotsWrapper.prepend(b),a({$jackpot:u.$slotsWrapper.find(".slots-jackpot")}),j=setInterval(function(){var a=_.random(0,50);t.jackpot+=a/100,v.jackpot="$"+t.jackpot.toLocaleString("en-US",{minimumFractionDigits:2}),b.innerHTML=v.jackpot},150)},k=function(){var b=document.createElement("div"),c=document.createElement("span"),d=document.createElement("span");b.className="slots-status-display show-start",c.className="slots-status-start",c.innerHTML=t.startMsg,d.className="slots-status-try-again",d.innerHTML=t.tryAgainMsg,b.appendChild(c),b.appendChild(d),u.$slotsWrapper.append(b),a({$statusDisplay:u.$slotsWrapper.find(".slots-status-display")}),$(document).on("slots-spinning",function(){b.className="slots-status-display"}).on("slots-stopped",function(){v.minorWin||v.majorWin||(b.className="slots-status-display show-try-again")})},l=function(){var b=document.createElement("button");b.className="slots-btn",b.innerHTML=t.spinBtnText,u.$slotsWrapper.append(b),a({$spinBtn:u.$slotsWrapper.find(".slots-btn")}),$(document).on("slots-spinning",function(){b.disabled=!0}).on("slots-stopped",function(){b.disabled=!1})},m=function(){var b=document.createElement("div");b.className="slots-winning-line",u.$slots.append(b),a({$winningLine:u.$slots.find(".slots-winning-line")})},n=function(a){if(a.preventDefault(),"minor"==v.prize&&($(document).trigger("slots-hide-win"),v.prize=null),!v.isSpinning){var b=0,c=0,d=v.minorWin||v.majorWin?2*t.duration:t.duration;for($(document).trigger("slots-spinning");b<t.cols;b++)c=t.duration,(v.minorWin||v.majorWin)&&b==t.cols-1&&(c=2*c),u.$slots.find("ul:eq("+b+")").delay(t.delayed*b).animate({top:v.offsetPixel},c,t.easing),d+=t.delayed;setTimeout(function(){$(document).trigger("slots-stopped"),console.log("spins: "+v.spins),console.log("minorWin: "+v.minorWin),console.log("majorWin: "+v.majorWin),_.each(e(),function(a,b){u.$slots.find("ul:eq("+b+")").prepend(a.innerHTML).css("top",v.topPixel)})},d),v.spins++}},o=function(){console.log("slotsSpinning"),v.isSpinning=!0},p=function(){console.log("slotsStopped"),v.isSpinning=!1,(v.minorWin||v.majorWin)&&r(),v.majorWin&&u.$spinBtn.off("click").on("click",q)};var w=function(){v.colLoadedCounter++,v.colLoadedCounter==t.cols&&u.$container.removeClass("slots-loading")};return q=function(){window.location="register"},r=function(){var a="";v.prize=v.minorWin?"minor":"major",a="minor"==v.prize?"50%":"257px",u.$winningLine.css({top:a}).addClass("flashing"),u.$spinBtn.prop("disabled",!0),setTimeout(function(){u.$winningLine.css({opacity:0}).removeClass("flashing"),u.$spinBtn.prop("disabled",!1),$(document).trigger({type:"slots-show-win",prize:v.prize,$spinBtn:u.$spinBtn,$jackpot:u.$jackpot})},3e3)},s=function(a){$.extend(t,a),c(),d(),u.$spinBtn.on("click",n),$(document).on("load-complete",w).on("slots-spinning",o).on("slots-stopped",p)},{init:s}}();